# 開発方針設計書（Logic Design Brief）テンプレート

## 1. 概要と目的
* **実装内容:** （例：クーポン機能の追加）
* **目的/Why:** （例：リピート率向上のため、決済時に割引を適用したい）

## 2. バックエンド方針（データとルール）
**A. データモデル (DB)**
* **変更の有無:** （有 / 無）
* **変更内容:**
    * `Coupon` テーブル作成（カラム: code, discount_rate, expiration...）
    * `User` に `coupon_usage_history` とのリレーション追加
    * ※物理削除か論理削除か、などの重要制約があれば記載

**B. API & ロジック**
* **エンドポイント方針:**
    * **新設/変更:** `POST /api/checkout` の変更
    * **ロジック変更点:**
        1. リクエストに `coupon_code` を許容する。
        2. **[重要]** バリデーション追加：決済履歴がないユーザーのみ適用可とする判定を追加。
        3. 決済確定処理前に割引計算ロジックを挟む。
* **共通ロジック:**
    * 割引計算モジュール（`PriceCalculator`）を共通化し、カート確認画面でも呼べるようにする。

## 3. フロントエンド方針（画面と遷移）
**A. 画面構成**
